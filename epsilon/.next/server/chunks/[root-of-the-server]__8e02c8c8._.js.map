{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 186, "column": 0}, "map": {"version":3,"sources":["file:///Users/zefir/projects/giger/epsilon/src/auth.ts"],"sourcesContent":["import NextAuth from 'next-auth';\nimport Credentials from 'next-auth/providers/credentials';\nimport { loginWithCredentials } from '@/services/api';\nimport { NextResponse } from 'next/server';\nimport { string } from 'yup';\n\n// Shape returned by your upstream login\ntype UpstreamLoginOk = {\n    status: 'ok';\n    token: string; // apiToken\n    user: {\n        id: string;\n        handle?: string | null;\n        faction?: string | null;\n        factionRankActual?: string | number | null;\n        factionRankPublic?: string | number | null;\n    };\n};\n\ntype UpstreamLoginErr = {\n    status: 'error' | 'fail';\n    message: string;\n};\n\ntype UpstreamLoginResp = UpstreamLoginOk | UpstreamLoginErr;\n\nconst mockLoginEnabled =\n    process.env.NEXT_PUBLIC_ENABLE_MOCK_LOGIN === 'true' ||\n    process.env.ENABLE_MOCK_LOGIN === 'true' ||\n    process.env.NODE_ENV !== 'production';\n\ntype MockPersona = {\n    username: string;\n    password: string;\n    profile: {\n        id: string;\n        handle: string | null;\n        faction: string | null;\n        factionRankActual: string | number | null;\n        factionRankPublic: string | number | null;\n        apiToken?: string;\n    };\n};\n\nconst mockPersonas: MockPersona[] = [\n    {\n        username: 'mock-operator',\n        password: process.env.MOCK_OPERATOR_PASSWORD ?? 'mock-operator',\n        profile: {\n            id: 'mock-operator',\n            handle: 'Dev Operator',\n            faction: 'epsilon',\n            factionRankActual: 'systems',\n            factionRankPublic: 'operator',\n            apiToken: 'mock-operator-token',\n        },\n    },\n    {\n        username: 'mock-police',\n        password: process.env.MOCK_POLICE_PASSWORD ?? 'mock-police',\n        profile: {\n            id: 'mock-police',\n            handle: 'OMG Liaison',\n            faction: 'o_m_g',\n            factionRankActual: 'investigator',\n            factionRankPublic: 'officer',\n            apiToken: 'mock-police-token',\n        },\n    },\n];\n\nconst providers = [\n    Credentials({\n        id: 'credentials',\n        name: 'Credentials',\n        credentials: {\n            username: { label: 'Username', type: 'text' },\n            password: { label: 'Password', type: 'password' },\n        },\n        async authorize(credentials) {\n            const username = credentials?.username?.trim();\n            const password = credentials?.password;\n\n            if (!username || !password) {\n                throw new Error('Missing username or password');\n            }\n\n            try {\n                const response = (await loginWithCredentials(\n                      username,\n                      password\n                )) as UpstreamLoginResp;\n\n                if (response && response.status === 'ok') {\n                    // Return exactly what you want to copy into the JWT on first sign-in\n                    const u = response.user;\n                    return {\n                        id: u.id,\n                        handle: u.handle ?? null,\n                        faction: u.faction ?? null,\n                        factionRankActual: u.factionRankActual ?? null,\n                        factionRankPublic: u.factionRankPublic ?? null,\n                        apiToken: response.token, // keep server-only ideally\n                    };\n                }\n\n                // Upstream error:\n                const msg =\n                      (response as UpstreamLoginErr)?.message || 'Invalid credentials';\n                throw new Error(msg);\n            } catch (e) {\n                throw new Error(e instanceof Error ? e.message : String(e));\n            }\n        },\n    }),\n    Credentials({\n        id: 'police',\n        name: 'Police',\n        credentials: {\n            username: { label: 'Username', type: 'text' },\n            password: { label: 'Password', type: 'password' },\n        },\n        async authorize(credentials) {\n            const username = credentials?.username?.trim();\n            const password = credentials?.password;\n\n            if (!username || !password) {\n                throw new Error('Missing username or password');\n            }\n\n            try {\n                const response = (await loginWithCredentials(\n                      username,\n                      password\n                )) as UpstreamLoginResp;\n\n                if (response && response.status === 'ok') {\n                    const u = response.user;\n                    if (u.faction !== 'o_m_g') throw new Error('You don have access to this database');\n\n                    return {\n                        id: u.id,\n                        handle: u.handle ?? null,\n                        faction: u.faction ?? null,\n                        factionRankActual: u.factionRankActual ?? null,\n                        factionRankPublic: u.factionRankPublic ?? null,\n                        apiToken: response.token, // keep server-only ideally\n                    };\n                }\n\n                // Upstream error:\n                const msg =\n                      (response as UpstreamLoginErr)?.message || 'Invalid credentials';\n                throw new Error(msg);\n            } catch (e) {\n                throw new Error(e instanceof Error ? e.message : String(e));\n            }\n        },\n    }),\n];\n\nif (mockLoginEnabled) {\n    providers.push(\n        Credentials({\n            id: 'mock',\n            name: 'Mock Access',\n            credentials: {\n                username: { label: 'Persona', type: 'text' },\n                password: { label: 'Passphrase', type: 'password' },\n            },\n            async authorize(credentials) {\n                if (!mockLoginEnabled) throw new Error('Mock login disabled');\n\n                const username = credentials?.username?.trim();\n                const password = credentials?.password;\n\n                if (!username || !password) {\n                    throw new Error('Missing persona or passphrase');\n                }\n\n                const persona = mockPersonas.find(\n                    (entry) => entry.username === username && entry.password === password\n                );\n\n                if (!persona) {\n                    throw new Error('Mock credentials invalid');\n                }\n\n                return {\n                    id: persona.profile.id,\n                    handle: persona.profile.handle,\n                    faction: persona.profile.faction,\n                    factionRankActual: persona.profile.factionRankActual,\n                    factionRankPublic: persona.profile.factionRankPublic,\n                    apiToken: persona.profile.apiToken,\n                };\n            },\n        })\n    );\n}\n\nexport const {\n    auth,\n    signIn,\n    signOut,\n    handlers: { GET, POST },\n} = NextAuth({\n    pages: { signIn: '/login' },\n    session: { strategy: 'jwt' },\n    providers,\n    callbacks: {\n        async jwt({ token, user, trigger, session }) {\n            // First sign-in: copy fields from user → token\n            if (user) {\n                token.id = (user as any).id as string;\n                token.handle = (user as any).handle ?? null;\n                token.faction = (user as any).faction ?? null;\n                token.factionRankActual = (user as any).factionRankActual ?? null;\n                token.factionRankPublic = (user as any).factionRankPublic ?? null;\n\n                // Keep apiToken on the token (server-side). Only expose to client if you truly need it.\n                token.apiToken = (user as any).apiToken as string | undefined;\n            }\n\n            // Optional: allow client-driven session update to tweak selected fields\n            if (trigger === 'update' && session?.user) {\n                const su = session.user as any;\n                if (su.handle !== undefined) token.handle = su.handle;\n                if (su.faction !== undefined) token.faction = su.faction;\n                if (su.factionRankActual !== undefined)\n                    token.factionRankActual = su.factionRankActual;\n                if (su.factionRankPublic !== undefined)\n                    token.factionRankPublic = su.factionRankPublic;\n            }\n\n            return token;\n        },\n\n        async session({ session, token }) {\n            // ⚠️ Only expose non-sensitive data to the browser\n            session.user = {\n                ...session.user,\n                id: (token as any).userId as string,\n                handle: (token as any).handle ?? null,\n                faction: (token as any).faction ?? null,\n                factionRankActual: (token as any).factionRankActual ?? null,\n                factionRankPublic: (token as any).factionRankPublic ?? null,\n            };\n\n            // If you truly need the apiToken client-side, expose it (not generally recommended)\n            if ((token as any).apiToken) {\n                (session as any).apiToken = (token as any).apiToken as string;\n            }\n\n            return session;\n        },\n    },\n});\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 401, "column": 0}, "map": {"version":3,"sources":["file:///Users/zefir/projects/giger/epsilon/src/services/api.ts"],"sourcesContent":["import axios, { AxiosInstance } from 'axios'\nimport { auth } from '@/auth';\nimport { NextResponse } from 'next/server';\n\n/**\n * Shared Axios instance for server/client requests.\n * - Uses NEXT_PUBLIC_API_BASE_URL in the browser and API_BASE_URL on the server.\n * - Exposes a helper to set/clear the AuthToken header.\n */\nconst baseURL =\n  typeof window === 'undefined'\n    ? process.env.API_BASE_URL\n    : process.env.NEXT_PUBLIC_API_BASE_URL;\n\nif (!baseURL) {\n    // Fail fast so misconfiguration is obvious during development\n    // (in production you might want to log instead).\n    console.warn('[api] baseURL is not defined. Did you set API_BASE_URL / NEXT_PUBLIC_API_BASE_URL?');\n}\n\nconst api: AxiosInstance = axios.create({\n    baseURL: baseURL,\n    timeout: 10000,\n});\n\n/**\n * Set or clear the AuthToken header on the shared axios instance.\n */\nexport function setAuthToken(token?: string | null) {\n    if (token) {\n        (api.defaults.headers.common as { AuthToken: string }).AuthToken = token;\n    } else {\n        delete (api.defaults.headers.common as { AuthToken: string }).AuthToken;\n    }\n}\n\n/**\n * Perform credentials login against the backend.\n * Returns the api token string (and sets it as default auth header for client-side calls).\n */\nexport async function loginWithCredentials(username: string, password: string): Promise<{ status: 'ok' | 'error', user: { handle:  string, }, token: string, message?: string }> {\n    try {\n        const { data } = await api.get<string>('/Login/giger', {\n            params: { username, password },\n        });\n        if (typeof window !== 'undefined') {\n            setAuthToken(data);\n        }\n        const profileResponse = await axios.get(\n          `${baseURL}/User/private/byUsername`,\n          { params: { userName: username }, headers: { AuthToken: data } }\n        );\n        return { status: 'ok', user: profileResponse.data, token: data, };\n    } catch (e) {\n        return { status: 'error', message: e };\n    }\n}\n\nexport default api;\n\nexport async function get(url: string): Promise<any> {\n    const session = await auth()\n    if (!session) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    const token: string = (session as { apiToken: string, }).apiToken;\n    if (!token) {\n        return NextResponse.json({ error: 'Missing API token' }, { status: 401 })\n    }\n\n    const upstreamUrl = `${process.env.API_BASE_URL}/${url}`;\n    const upstream = await fetch(upstreamUrl, {\n        method: \"GET\",\n        headers: { AuthToken: token, },\n        cache: \"no-store\",\n    });\n\n    const rawData = await upstream.json().catch(() => null);\n    if (!rawData) {\n        return NextResponse.json({ error: 'Invalid JSON from upstream' }, { status: 502 })\n    }\n\n    return rawData;\n}\nconst API_BASE =\n  process.env.NEXT_PUBLIC_API_BASE_URL ||\n  process.env.API_BASE_URL ||\n  '';\n\nconst buildUrl = (path: string) =>\n  path.startsWith('http') ? path : `${API_BASE}${path.startsWith('/') ? '' : '/'}${path}`;\n\nasync function handleResponse(res: Response) {\n    if (!res.ok) {\n        // Try to extract a useful error message from JSON, otherwise use status text\n        let message = `Request failed (${res.status})`;\n        try {\n            const data = await res.json();\n            message = data?.error || data?.message || message;\n        } catch {\n            // ignore JSON parse errors\n        }\n        throw new Error(message);\n    }\n\n    // 204 No Content or empty body\n    if (res.status === 204) return null;\n\n    const ct = res.headers.get('content-type') || '';\n    return ct.includes('application/json') ? res.json() : res.text();\n}\n\n/**\n * DELETE helper.\n * Usage:\n *   await del(`Conversation/${id}`);\n *   // or with options: await del(`Conversation/${id}`, { headers: { ... } });\n *   // if you need to send a JSON body (rare for DELETE), pass a stringified body in options.body\n */\nexport async function del(path: string, options: RequestInit = {}) {\n    const session = await auth()\n    if (!session) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n    const token: string = (session as { apiToken: string, }).apiToken;\n    const url = buildUrl(path);\n    const res = await fetch(url, {\n        method: 'DELETE',\n        // keep headers unobtrusive; only set JSON header if caller provides a body\n        headers: {\n            AuthToken: token\n        },\n    });\n    return handleResponse(res);\n}\n\nexport async function post(url: string, payload?: unknown): Promise<any> {\n    const session = await auth();\n    if (!session) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const token: string = (session as { apiToken: string }).apiToken;\n    if (!token) {\n        return NextResponse.json({ error: 'Missing API token' }, { status: 401 });\n    }\n\n    const base = process.env.API_BASE_URL || '';\n    const upstreamUrl = `${base}${url.startsWith('/') ? '' : '/'}${url}`;\n\n    // If payload is FormData, let fetch set Content-Type; otherwise send JSON\n    const isFormData =\n      typeof FormData !== 'undefined' && payload instanceof FormData;\n\n    const res = await fetch(upstreamUrl, {\n        method: 'POST',\n        headers: {\n            AuthToken: token,\n            ...(isFormData ? {} : { 'Content-Type': 'application/json' }),\n        },\n        body: isFormData ? (payload as FormData) : payload ? JSON.stringify(payload) : undefined,\n        cache: 'no-store',\n    });\n\n    // Keep behavior similar to your GET: try to parse JSON, else fail\n    const rawData = await res.json().catch(() => null);\n    if (!rawData) {\n        return NextResponse.json({ error: 'Invalid JSON from upstream' }, { status: 502 });\n    }\n\n    return rawData;\n}\n\nexport async function patch(path: string, payload?: unknown): Promise<any> {\n    const session = await auth();\n    if (!session) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const token: string = (session as { apiToken: string }).apiToken;\n    if (!token) {\n        return NextResponse.json({ error: 'Missing API token' }, { status: 401 });\n    }\n\n    const url = buildUrl(path);\n\n    // If payload is FormData, let fetch set Content-Type; otherwise send JSON\n    const isFormData =\n      typeof FormData !== 'undefined' && payload instanceof FormData;\n\n    const res = await fetch(url, {\n        method: 'PATCH',\n        headers: {\n            AuthToken: token,\n            ...(isFormData ? {} : { 'Content-Type': 'application/json' }),\n        },\n        body: isFormData\n          ? (payload as FormData)\n          : payload\n            ? JSON.stringify(payload)\n            : undefined,\n        cache: 'no-store',\n    });\n\n    return handleResponse(res);\n}\n\nexport async function put(path: string, payload?: unknown): Promise<any> {\n    const session = await auth();\n    if (!session) {\n        return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n    }\n\n    const token: string = (session as { apiToken: string }).apiToken;\n    if (!token) {\n        return NextResponse.json({ error: 'Missing API token' }, { status: 401 });\n    }\n\n    const url = buildUrl(path);\n\n    // If payload is FormData, let fetch set Content-Type; otherwise send JSON\n    const isFormData =\n      typeof FormData !== 'undefined' && payload instanceof FormData;\n\n    const res = await fetch(url, {\n        method: 'PUT',\n        headers: {\n            AuthToken: token,\n            ...(isFormData ? {} : { 'Content-Type': 'application/json' }),\n        },\n        body: isFormData\n          ? (payload as FormData)\n          : payload\n            ? JSON.stringify(payload)\n            : undefined,\n        cache: 'no-store',\n    });\n\n    return handleResponse(res);\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 656, "column": 0}, "map": {"version":3,"sources":["file:///Users/zefir/projects/giger/epsilon/src/app/api/mappers/user.ts"],"sourcesContent":["export function mapUser(data: ApiUser) {\n  return {\n    ...data\n  }\n}\n\n// Atomic pieces\nexport interface StatBlock {\n  stat: number;\n}\n\nexport type VibeEngagement = 'HYPED' | 'FANATIC' | string;\nexport type WealthLevel = 'BROKE' | 'STABLE' | 'COMFORTABLE' | string;\nexport type EntityType = 'AI' | 'HUMAN' | string;\nexport type MindHackState = 'DISABLED' | string;\n\nexport interface GigReputation {\n  FIXER: number;\n  KILLER: number;\n  HACKING: number;\n  WELLBEING: number;\n}\n\n// Records visible in profile sections\ninterface WithId {\n  id: string;\n}\ninterface Revealable {\n  isRevealed: boolean;\n}\n\nexport interface PrivateRecord extends WithId, Revealable {\n  recordType: 'PRIVATE_RECORD';\n  title: string;\n  description: string;\n}\n\nexport interface RelationRecord extends WithId, Revealable {\n  recordType: 'RELATION';\n  userName: string;\n  description: string;\n}\n\nexport interface GoalRecord extends WithId, Revealable {\n  recordType: 'GOAL';\n  title: string;\n  description: string;\n}\n\nexport interface MetaRecord extends WithId {\n  recordType: 'META';\n  title: string;\n  description: string;\n}\n\n// Timeline events\nexport type EventStatus = 'CURRENT' | 'HISTORICAL' | string;\n\nexport type CriminalEventType = 'SUSPECT' | 'PUNISHMENT' | string;\nexport interface CriminalEvent extends WithId, Revealable {\n  type: CriminalEventType;\n  name: string;\n  eventDescription: string;\n  status: EventStatus;\n  timeStamp: string; // ISO\n}\n\nexport type MedicalEventType = 'CYBERWARE' | 'MEDICAL_PROCEDURE' | string;\nexport interface MedicalEvent extends WithId, Revealable {\n  type: MedicalEventType;\n  name: string;\n  eventDescription: string;\n  status: EventStatus;\n  timeStamp: string; // ISO\n}\n\n// Main User shape\nexport interface ApiUser {\n  id: string;\n  handle: string;\n  hackerName: string;\n\n  name: string;\n  surname: string;\n\n  active: boolean;\n  roles: string[];\n  aliasMap: Record<string, string>;\n\n  // Types & factions\n  typeActual: EntityType;\n  typePublic: EntityType;\n  faction: string;                 // e.g., \"foundation\", \"gunners\", \"no_faction\"\n  factionRankActual: string;\n  factionRankPublic: string;\n\n  // Network placement\n  networkId: string;\n  networkName: string;\n  subnetworkId: string;\n  subnetworkName: string;\n  networkAdminName: string;\n\n  // Vibe & wealth\n  vibe: string;                    // e.g., \"OVERSEERS\", \"NO_VIBE\", \"DIZORDERS\"\n  vibeFunction: string;\n  vibeOpinions: string | null;\n  vibeEngagement: VibeEngagement;\n  wealthLevel: WealthLevel;\n\n  // Stats & skills\n  cyberwareLevel: StatBlock;\n  hackingSkills: StatBlock;\n  confrontationistVsAgreeable: StatBlock;\n  cowardVsBrave: StatBlock;\n  talkativeVsSilent: StatBlock;\n  thinkerVsDoer: StatBlock;\n  combatSkill: StatBlock;\n\n  // Reputation & economy\n  gigReputation: GigReputation;\n  insuredAmount: number;\n  reputationDescription: string | null;\n\n  // Access / flags\n  hasPlatinumPass: boolean;\n  highSecurity: boolean;\n\n  // Relationships & preferences\n  favoriteUserIds: string[];\n  relations: RelationRecord[];\n  goals: GoalRecord[];\n\n  // Records / notes\n  privateRecords: PrivateRecord[];\n  meta: MetaRecord[];\n\n  // Events\n  criminalEvents: CriminalEvent[];\n  medicalEvents: MedicalEvent[];\n\n  // Tools / abilities\n  exploits: string[];\n  mindHack: MindHackState;\n  mindHackEnabledFor: string[];\n\n  // Misc\n  assets: unknown[];\n}\n"],"names":[],"mappings":";;;AAAO,SAAS,QAAQ,IAAa;IACnC,OAAO;QACL,GAAG,IAAI;IACT;AACF","debugId":null}},
    {"offset": {"line": 668, "column": 0}, "map": {"version":3,"sources":["file:///Users/zefir/projects/giger/epsilon/src/app/api/users/route.ts"],"sourcesContent":["import { NextResponse, NextRequest } from 'next/server'\nimport { get, post } from '@/services/api'\nimport { mapUser } from '../mappers/user';\n\nexport async function GET() {\n  const data = await get('User/private/all');\n  if (!Array.isArray(data)) {\n    return NextResponse.json({ error: 'Invalid response.' }, { status: 502 })\n  }\n  const users = data.map(mapUser);\n  return NextResponse.json({ users }, { status: 200 });\n}\n\nexport async function POST(req: NextRequest) {\n  const payload = await req.json().catch(() => null);\n  if (!payload) {\n    return NextResponse.json({ error: 'Invalid JSON body' }, { status: 400 });\n  }\n\n  try {\n    // Forward to your upstream (e.g., /Profile)\n    const data = await post('/User', payload);\n    return NextResponse.json(data, { status: 200 });\n  } catch (err: any) {\n    return NextResponse.json(\n      { error: err?.message || 'Upstream error' },\n      { status: 500 }\n    );\n  }\n}\n\nexport async function PUT(req: NextRequest) {\n  const payload = await req.json().catch(() => null);\n  if (!payload) {\n    return NextResponse.json({ error: 'Invalid JSON body' }, { status: 400 });\n  }\n\n  try {\n    console.log('------payload', payload)\n    // Forward to your upstream (e.g., /Profile)\n    const data = await post('/User', payload);\n    console.log('------data', data)\n    return NextResponse.json(data, { status: 200 });\n  } catch (err: any) {\n    console.log('------err', err)\n    return NextResponse.json(\n      { error: err?.message || 'Upstream error' },\n      { status: 500 }\n    );\n  }\n}"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,MAAM,OAAO,MAAM,CAAA,GAAA,wHAAA,CAAA,MAAG,AAAD,EAAE;IACvB,IAAI,CAAC,MAAM,OAAO,CAAC,OAAO;QACxB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;IACA,MAAM,QAAQ,KAAK,GAAG,CAAC,sIAAA,CAAA,UAAO;IAC9B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE;IAAM,GAAG;QAAE,QAAQ;IAAI;AACpD;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,UAAU,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;IAC7C,IAAI,CAAC,SAAS;QACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;IAEA,IAAI;QACF,4CAA4C;QAC5C,MAAM,OAAO,MAAM,CAAA,GAAA,wHAAA,CAAA,OAAI,AAAD,EAAE,SAAS;QACjC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ;QAAI;IAC/C,EAAE,OAAO,KAAU;QACjB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO,KAAK,WAAW;QAAiB,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,UAAU,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM;IAC7C,IAAI,CAAC,SAAS;QACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;IAEA,IAAI;QACF,QAAQ,GAAG,CAAC,iBAAiB;QAC7B,4CAA4C;QAC5C,MAAM,OAAO,MAAM,CAAA,GAAA,wHAAA,CAAA,OAAI,AAAD,EAAE,SAAS;QACjC,QAAQ,GAAG,CAAC,cAAc;QAC1B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC,MAAM;YAAE,QAAQ;QAAI;IAC/C,EAAE,OAAO,KAAU;QACjB,QAAQ,GAAG,CAAC,aAAa;QACzB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO,KAAK,WAAW;QAAiB,GAC1C;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}